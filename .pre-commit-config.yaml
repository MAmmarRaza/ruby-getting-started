# Pre-commit hooks configuration
# Install: gem install pre-commit
# Setup: pre-commit install

repos:
  - repo: local
    hooks:
      - id: rubocop
        name: RuboCop
        entry: bundle exec rubocop
        language: system
        types: [ruby]
        pass_filenames: false
        always_run: true

      - id: brakeman
        name: Brakeman Security Scan
        entry: bundle exec brakeman --no-pager --quiet
        language: system
        types: [ruby]
        pass_filenames: false
        always_run: true

      - id: query-check
        name: Query Pattern Check
        entry: bundle exec rake quality:check_queries
        language: system
        types: [ruby]
        pass_filenames: false
        always_run: false

      - id: trailing-whitespace
        name: Trailing Whitespace
        entry: bash -c 'git diff --cached --name-only --diff-filter=ACM | grep -E "\.(rb|erb|yml|yaml)$" | xargs sed -i "s/[[:space:]]*$//"'
        language: system

      - id: no-commit-credentials
        name: Prevent committing credentials
        entry: bash -c 'if git diff --cached | grep -E "(password|secret|api_key|private_key)" | grep -v "test\|spec"; then echo "‚ùå Potential credentials detected. Review your changes."; exit 1; fi'
        language: system
        always_run: true
